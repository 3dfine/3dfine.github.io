var managerFBXLoad=new THREE.LoadingManager;managerFBXLoad.onProgress=function(url,itemsLoaded,itemsTotal){blockLoadProgress.style.width=50*itemsLoaded/itemsTotal+"vmax"};var globalLoad=0;var loader=new THREE.FBXLoader(managerFBXLoad);
var loadFBXModel=function(modelTarget,scaleImport,_material,url){loader.load(url,function(object){for(var i=0;i<object.children.length;i++){object.children[i].material=_material;object.children[i].materialDefult=_material;object.children[i].castShadow=true;object.children[i].receiveShadow=true}object.scale.multiplyScalar(scaleImport);modelTarget.add(object);globalLoad++})};
var loadAnimFBXModel=function(animationGroup,modelTarget,position,rotation,scaleImport,_material,url){loader.load(url,function(object){for(var i=0;i<object.children.length;i++){animationGroup.add(object.children[i]);object.children[i].material=_material}object.scale.multiplyScalar(scaleImport);object.rotation.x=THREE.Math.degToRad(rotation.x);object.rotation.y=THREE.Math.degToRad(rotation.y);object.rotation.z=THREE.Math.degToRad(rotation.z);object.position.set(position.x,position.y,position.z);modelTarget.add(object)})};
var managerLoadTextures=new THREE.LoadingManager;managerLoadTextures.onLoad=function(){console.log("Textures loading complete!")};var textureLoader=new THREE.TextureLoader(managerLoadTextures);var onepix=textureLoader.load("textures/Onepix.jpg");var StainlessGunMetal_albedo=textureLoader.load("textures/metals/StainlessGunMetal_albedo.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1,1)});
var StainlessGunMetal_roughness=textureLoader.load("textures/metals/StainlessGunMetal_roughness.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1,1)});var RepolishedCopper_albedo=textureLoader.load("textures/metals/RepolishedCopper_albedo.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1,1)});
var RepolishedCopper_roughness=textureLoader.load("textures/metals/RepolishedCopper_roughness.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1,1)});var matSteelTexture=textureLoader.load("textures/metals/SteelNerg.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1,1)});
var matSteelTexture2=textureLoader.load("textures/metals/stainless-steel1.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(6,1)});var vert_fon=textureLoader.load("textures/fon/surface-screen.jpg");var vert_fonGor=textureLoader.load("textures/fon/surface-screen_TV.jpg");var wood1=textureLoader.load("textures/wood/wood1.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(7,2)});
var wood1rough=textureLoader.load("textures/wood/wood1rough.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(7,2)});var filtr1_hight=textureLoader.load("textures/filtr1_hight.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1,1)});
var filtr2_hight=textureLoader.load("textures/filtr2_hight.jpg",function(texture){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1,1)});var textureCube=(new THREE.CubeTextureLoader).setPath("textures/cube/station/").load(["as_0000.jpg","as_0001.jpg","as_0002.jpg","as_0003.jpg","as_0004.jpg","as_0005.jpg"]);
THREE.GhostShader={uniforms:{"mRefractionRatio":{value:1.02},"mFresnelBias":{value:.1},"mFresnelPower":{value:2},"mFresnelScale":{value:1},"tCube":{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","varying float viewNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );",
"vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","viewNormal = abs(0.4 * normalize( dot( I, vReflect )) / (length(I)*length(vReflect)))+ 0.1; ","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );",
"vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","varying float viewNormal;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","reflectedColor.a = viewNormal;",
"refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","refractedColor.a = viewNormal;","gl_FragColor = reflectedColor;","}"].join("\n")};var matAluminuim=new THREE.MeshStandardMaterial({color:3355443,metalness:.8,roughness:.3,needsUpdate:true});
var matSteel=new THREE.MeshStandardMaterial({color:11184810,metalness:.75,roughness:.6,needsUpdate:true});var matSteelNerg=new THREE.MeshStandardMaterial({color:13959168,metalness:.9,roughness:.1,needsUpdate:true});var matRAL7045=new THREE.MeshStandardMaterial({color:2634811,metalness:.5,roughness:.3});var matBlueGloss=new THREE.MeshStandardMaterial({color:13018,metalness:.6,roughness:.3});var matBlueGlossDark=new THREE.MeshStandardMaterial({color:255,metalness:.2,roughness:.2});
var matSteelClear=new THREE.MeshStandardMaterial({color:2634811,metalness:.7,roughness:.8});var stainlessGunMetal=new THREE.MeshStandardMaterial({color:11184810,metalness:.9,roughness:.6,needsUpdate:true,side:THREE.DoubleSide});var matGold=new THREE.MeshStandardMaterial({color:16761685,metalness:.9,roughness:.12});var matSilver=new THREE.MeshStandardMaterial({color:16315881,metalness:1,roughness:.2});var matCopper=new THREE.MeshStandardMaterial({color:251658239,metalness:.9,roughness:1,needsUpdate:true});
var matPlastic=new THREE.MeshStandardMaterial({color:131586,metalness:.2,roughness:.1,side:THREE.DoubleSide});var matRubber=new THREE.MeshStandardMaterial({color:197379,metalness:.2,roughness:.4,side:THREE.DoubleSide});var matPlasticBlack=new THREE.MeshLambertMaterial({color:0});var matDarkDoubleSide=new THREE.MeshLambertMaterial({color:2236962,side:THREE.DoubleSide});var matYellowDoubleSide=new THREE.MeshLambertMaterial({color:9671532,side:THREE.DoubleSide});
var matPlasticMatte=new THREE.MeshStandardMaterial({color:0,metalness:.2,roughness:.7});var matPlasticWhite=new THREE.MeshStandardMaterial({color:16777215,metalness:.4,roughness:.3,side:THREE.DoubleSide});var matEkran=new THREE.MeshLambertMaterial({color:16777215});var matEkranGorizont=new THREE.MeshLambertMaterial({color:16777215});var matWood1=new THREE.MeshStandardMaterial({color:16777215,metalness:.6,roughness:1});
var matGlass2=new THREE.MeshStandardMaterial({color:0,metalness:1,roughness:.15,transparent:true,opacity:1});var matGhost=new THREE.MeshPhongMaterial({color:11184810,needsUpdate:true,transparent:true,side:THREE.DoubleSide,combine:THREE.MultiplyOperation,opacity:.5});var matWireframe=new THREE.MeshPhongMaterial({color:11184810,needsUpdate:true,transparent:true,wireframe:true,opacity:.5});var shader=THREE.FresnelShader;var uniforms=THREE.UniformsUtils.clone(shader.uniforms);
uniforms["tCube"].value=textureCube;var matGlass=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader,transparent:true});var matGhos2t=new THREE.ShaderMaterial({vertexShader:document.getElementById("2d-vertex-shader").textContent,fragmentShader:document.getElementById("2d-fragment-shader").textContent,transparent:true});var matStoikaVert=[new THREE.MeshStandardMaterial({color:16711680})];var matStoikaGoriz=[new THREE.MeshStandardMaterial({color:65280})];
var matStoikaGoriz2=[new THREE.MeshStandardMaterial({color:65280})];var matOpora=[new THREE.MeshStandardMaterial({color:131586,metalness:.9,roughness:.4})];var matUstRama=[new THREE.MeshStandardMaterial({color:16777215})];var matLopasti=[new THREE.MeshStandardMaterial({color:16777215})];var matFiltrKorman=[new THREE.MeshStandardMaterial({color:16777215})];var matRekuperator=[new THREE.MeshStandardMaterial({color:16777215})];var matPauk=[new THREE.MeshStandardMaterial({color:16777215})];
var matUstVent=[new THREE.MeshStandardMaterial({color:16777215})];var matUstVent2=[new THREE.MeshStandardMaterial({color:16777215})];var matKompressor=[new THREE.MeshStandardMaterial({color:16777215})];var matBarashki=[new THREE.MeshPhongMaterial({color:0,specular:2236962,shininess:35,normalMap:textureLoader.load("textures/barashka.png"),normalScale:new THREE.Vector2(1,1)})];var matPotokDef=new THREE.MeshPhongMaterial({color:16711680,transparent:true,opacity:0});var matUstKrisha=[new THREE.MeshStandardMaterial({color:16777215})];
matUstKrisha[0]=new THREE.MeshStandardMaterial({color:1118481});matUstKrisha[1]=new THREE.MeshPhongMaterial({color:16635957});matUstKrisha[2]=new THREE.MeshPhongMaterial({color:9479342});matUstKrisha[3]=new THREE.MeshStandardMaterial({color:12566463});var matPotokRed=new THREE.MeshPhongMaterial({color:16711680,specular:2236962,shininess:35,side:THREE.DoubleSide});var matPotokPink=new THREE.MeshPhongMaterial({color:16220094,specular:2236962,shininess:35,side:THREE.DoubleSide});
var matPotokDarkBlue=new THREE.MeshPhongMaterial({color:255,specular:2236962,shininess:35,side:THREE.DoubleSide});var matPotokBlue=new THREE.MeshPhongMaterial({color:3972863,specular:2236962,shininess:35,side:THREE.DoubleSide});
var matHolodSetup=function(){matAluminuim.envMap=textureCube;matRAL7045.envMap=textureCube;matBlueGlossDark.envMap=textureCube;matBlueGloss.envMap=textureCube;matBlueGloss.needsUpdate=true;matPlastic.envMap=textureCube;matPlastic.needsUpdate=true;matPlasticWhite.envMap=textureCube;matPlasticWhite.needsUpdate=true;stainlessGunMetal.envMap=textureCube;stainlessGunMetal.map=StainlessGunMetal_albedo;stainlessGunMetal.roughnessMap=StainlessGunMetal_roughness;stainlessGunMetal.needsUpdate=true;matSteel.envMap=
textureCube;matSteel.roughnessMap=matSteelTexture;matSteel.needsUpdate=true;matCopper.envMap=textureCube;matCopper.map=RepolishedCopper_albedo;matCopper.roughnessMap=RepolishedCopper_roughness;matUstRama[0]=matSteel;matUstRama[1]=matPlastic;matUstRama[2]=stainlessGunMetal;matUstRama[3]=matBlueGloss;matUstRama[4]=matPlasticWhite;matKompressor[1-1]=stainlessGunMetal;matKompressor[2-1]=matDarkDoubleSide;matKompressor[3-1]=matPlastic;matKompressor[4-1]=matCopper;matKompressor[5-1]=matBlueGlossDark;matKompressor[6-
1]=matPlasticWhite;matKompressor[7-1]=matRubber;matLopasti[0]=matPlastic;matLopasti[1]=matPlastic;matFiltrKorman[0]=matRAL7045;matFiltrKorman[1]=matSteel;matFiltrKorman[2]=matSteelClear;matFiltrKorman[3]=new THREE.MeshLambertMaterial({map:filtr2_hight});matFiltrKorman[4]=new THREE.MeshLambertMaterial({map:filtr1_hight});matRekuperator[0]=matDarkDoubleSide;matRekuperator[1]=matAluminuim;matRekuperator[2]=stainlessGunMetal;matRekuperator[3]=stainlessGunMetal;matPauk[1-1]=stainlessGunMetal;matPauk[2-
1]=matYellowDoubleSide;matPauk[3-1]=matCopper;matPauk[4-1]=stainlessGunMetal;matPauk[5-1]=matDarkDoubleSide;matUstVent[1-1]=matAluminuim;matUstVent[2-1]=stainlessGunMetal;matUstVent[3-1]=matPlastic;matUstVent[4-1]=matRAL7045;matUstVent[5-1]=matRubber;matUstVent[6-1]=matPlasticWhite;console.log("3dfine@mail.ru")};
var matStoikiSetup=function(){matGold.envMap=textureCube;matGold.needsUpdate=true;matWood1.envMap=textureCube;matWood1.needsUpdate=true;matSteelNerg.envMap=textureCube;matSteelNerg.needsUpdate=true;matEkranGorizont.map=vert_fonGor;matEkran.map=vert_fon;matWood1.map=wood1;matWood1.roughnessMap=wood1rough;matWood1.needsUpdate=true;matStoikaGoriz[0]=matGold;matStoikaGoriz[1]=matPlasticBlack;matStoikaGoriz[2]=matEkranGorizont;matStoikaGoriz[3]=matGlass;matStoikaGoriz[4]=matPlastic;matStoikaGoriz[5]=matSteelClear;
matStoikaGoriz2[0]=matSteelNerg;matStoikaGoriz2[1]=matPlasticBlack;matStoikaGoriz2[2]=matEkranGorizont;matStoikaGoriz2[3]=matGlass;matStoikaGoriz2[4]=matPlastic;matStoikaGoriz2[5]=matSteelClear;matStoikaVert[0]=matWood1;matStoikaVert[1]=matPlasticBlack;matStoikaVert[2]=matEkran;matStoikaVert[3]=matGlass;matStoikaVert[4]=matPlastic;matStoikaVert[5]=matSteelClear};console.log("3d models loading start...");var ustanovka=new THREE.Group;var ustVent1=new THREE.Group;var ustVent2=new THREE.Group;
var zaslonkaSborka1=new THREE.Group;var zaslonkaSborka2=new THREE.Group;var rekuperator=new THREE.Group;var ventilatorOutSide=new THREE.Group;var rama=new THREE.Object3D;loadFBXModel(rama,.5,matUstRama,"models/fbx/ustanovka/rama.FBX");var barashki=new THREE.Object3D;loadFBXModel(barashki,.5,matBarashki,"models/fbx/ustanovka/barashkiLow.FBX");var krisha=new THREE.Object3D;loadFBXModel(krisha,.5,matUstKrisha,"models/fbx/ustanovka/Krisha.FBX");var vent_nasos_korp=new THREE.Object3D;
loadFBXModel(vent_nasos_korp,.5,matUstVent,"models/fbx/ustanovka/vent_nasos_korp.FBX");var vent_nasos_ventil=new THREE.Object3D;loadFBXModel(vent_nasos_ventil,.5,matUstVent,"models/fbx/ustanovka/vent_nasos_ventil.FBX");var vent_nasos_korp2=new THREE.Object3D;loadFBXModel(vent_nasos_korp2,.5,matUstVent,"models/fbx/ustanovka/vent_nasos_korp.FBX");var vent_nasos_ventil2=new THREE.Object3D;loadFBXModel(vent_nasos_ventil2,.5,matUstVent,"models/fbx/ustanovka/vent_nasos_ventil.FBX");
var rekuperatorKorp=new THREE.Object3D;loadFBXModel(rekuperatorKorp,.5,matRekuperator,"models/fbx/ustanovka/rekuperatorKorp.FBX");var rekuperatorZaslon1=new THREE.Object3D;loadFBXModel(rekuperatorZaslon1,.5,matUstRama,"models/fbx/ustanovka/rekuperatorZaslon1.FBX");var rekuperatorZaslon2=new THREE.Object3D;loadFBXModel(rekuperatorZaslon2,.5,matUstRama,"models/fbx/ustanovka/rekuperatorZaslon1.FBX");var rekuperatorZaslon3=new THREE.Object3D;loadFBXModel(rekuperatorZaslon3,.5,matUstRama,"models/fbx/ustanovka/rekuperatorZaslon3.FBX");
var filtrKorman1=new THREE.Object3D;loadFBXModel(filtrKorman1,.5,matFiltrKorman,"models/fbx/ustanovka/filtrKasetni.FBX");var filtrKorman2=new THREE.Object3D;loadFBXModel(filtrKorman2,.5,matFiltrKorman,"models/fbx/ustanovka/filtrKasetni.FBX");var ventilatorOutSide_korp=new THREE.Object3D;loadFBXModel(ventilatorOutSide_korp,.5,matUstVent,"models/fbx/ustanovka/ventilatorOutSide_korp.FBX");var ventilatorOutSide_lopasti=new THREE.Object3D;loadFBXModel(ventilatorOutSide_lopasti,.5,matLopasti,"models/fbx/ustanovka/ventilatorOutSide_lopasti.FBX");
ventilatorOutSide_lopasti.position.set(219.752/2,1266.646/2,2160/2);ventilatorOutSide_lopasti.rotation.y=THREE.Math.degToRad(90);var kompressoLOW=new THREE.Object3D;loadFBXModel(kompressoLOW,.5,matKompressor,"models/fbx/ustanovka/kompressoLOW.FBX");var zaslonka1_Rama=new THREE.Object3D;loadFBXModel(zaslonka1_Rama,.5,matUstRama,"models/fbx/ustanovka/Zaslonka1_Rama.FBX");var zaslonka2_Rama=new THREE.Object3D;loadFBXModel(zaslonka2_Rama,.5,matUstRama,"models/fbx/ustanovka/Zaslonka2_Rama.FBX");
var zaslonka1=new THREE.Object3D;loadFBXModel(zaslonka1,.5,matUstRama,"models/fbx/ustanovka/Zaslonka1Close.FBX");zaslonka1.position.set(0/2,176.679/2,0/2);var pauk=new THREE.Object3D;loadFBXModel(pauk,.5,matPauk,"models/fbx/ustanovka/paukLow1.FBX");var nagretSoplya=new THREE.Object3D;loadFBXModel(nagretSoplya,.5,matKompressor,"models/fbx/ustanovka/nagretSoplya.FBX");var diffuzorKorp=new THREE.Object3D;loadFBXModel(diffuzorKorp,.5,matPlasticWhite,"models/fbx/ustanovka/diffuzorKorp.FBX");
var diffuzorLopasti=new THREE.Object3D;loadFBXModel(diffuzorLopasti,.5,matPauk,"models/fbx/ustanovka/diffuzorLopasti.FBX");var zaslonka2=new THREE.Object3D;loadFBXModel(zaslonka2,.5,matUstRama,"models/fbx/ustanovka/Zaslonka2Close.FBX");zaslonka2.position.set(0/2,0/2,0/2);zaslonka2.rotation.y=THREE.Math.degToRad(-90);var potok1=new THREE.Object3D;loadFBXModel(potok1,.5,matPotokDef,"models/fbx/ustanovka/potok1.FBX");potok1.rotation.y=THREE.Math.degToRad(-90);potok1.visible=false;var potok2=new THREE.Object3D;
loadFBXModel(potok2,.5,matPotokDef,"models/fbx/ustanovka/potok2.FBX");potok2.rotation.y=THREE.Math.degToRad(-90);potok2.visible=false;ustVent1.add(vent_nasos_korp);ustVent1.add(vent_nasos_ventil);ustVent1.rotSpeed=0;ustVent2.add(vent_nasos_korp2);ustVent2.add(vent_nasos_ventil2);ustVent2.rotSpeed=0;zaslonkaSborka1.add(zaslonka1_Rama);zaslonkaSborka1.add(zaslonka1);zaslonkaSborka1.position.set(393.977/2,710.824/2,-2001.979/2);zaslonkaSborka2.add(zaslonka2_Rama);zaslonkaSborka2.add(zaslonka2);
zaslonkaSborka2.position.set(0/2,1264.692/2,-2195.049/2);ventilatorOutSide.add(ventilatorOutSide_korp);ventilatorOutSide.add(ventilatorOutSide_lopasti);ventilatorOutSide.rotSpeed=0;rekuperator.add(rekuperatorKorp);rekuperatorZaslon1.position.set(-269.554/2,950.514/2,112.29/2);rekuperatorZaslon1.rotation.x=THREE.Math.degToRad(-45);rekuperator.add(rekuperatorZaslon1);rekuperatorZaslon2.position.set(-269.554/2,950.514/2,-112.29/2);rekuperatorZaslon2.rotation.x=THREE.Math.degToRad(45);rekuperator.add(rekuperatorZaslon2);
rekuperatorZaslon3.position.set(179.746/2,950.514/2,-112.29/2);rekuperatorZaslon3.rotation.x=THREE.Math.degToRad(45);rekuperator.add(rekuperatorZaslon3);rekuperator.position.set(0/2,461.535/2,-1150.785/2);ustVent1.children[1].position.y=128.626;ustVent2.children[1].position.y=128.626;ustVent1.position.set(0,458.927/2,-300.059/2);ustVent2.rotation.y=THREE.Math.degToRad(180);ustVent2.position.set(0,1011.533/2,-300.059/2);filtrKorman1.position.set(0/2,1264.329/2,581.448/2);filtrKorman1.rotation.y=THREE.Math.degToRad(180);
filtrKorman2.position.set(0/2,1264.329/2,-2139.475/2);ustanovka.add(ustVent1);ustanovka.add(ustVent2);ustanovka.add(rama);ustanovka.add(barashki);ustanovka.add(krisha);ustanovka.add(zaslonkaSborka1);ustanovka.add(zaslonkaSborka2);ustanovka.add(rekuperator);ustanovka.add(filtrKorman1);ustanovka.add(filtrKorman2);ustanovka.add(ventilatorOutSide);ustanovka.add(kompressoLOW);ustanovka.add(pauk);ustanovka.add(diffuzorKorp);ustanovka.add(diffuzorLopasti);ustanovka.add(nagretSoplya);
ustanovka.rotation.y=THREE.Math.degToRad(-90);
managerFBXLoad.onLoad=function(){ventilatorOutSide.rotSpeed=.1;ustVent1.rotSpeed=.1;ustVent2.rotSpeed=.1;rekuperatorKorp.children[0].children[0].material=matRekuperator;rekuperatorKorp.children[0].children[1].material=matSteel;rekuperatorKorp.children[0].children[2].material=matSteel;rekuperatorKorp.children[0].children[3].material=matSteel;rekuperatorKorp.children[0].children[0].description="\u0420\u0435\u043a\u0443\u043f\u0435\u0440\u0430\u0442\u043e\u0440";filtrKorman1.children[0].children[0].description=
"\u0424\u0438\u043b\u044c\u0442\u0440 \u043a\u043e\u0440\u043c\u0430\u043d\u043d\u044b\u0439";filtrKorman2.children[0].children[0].description="\u0412\u043e\u0437\u0434\u0443\u0448\u043d\u044b\u0439 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u0440\u0438\u0442\u043e\u0447\u043d\u043e\u0433\u043e \u0432\u043e\u0437\u0434\u0443\u0445\u0430";vent_nasos_korp.children[0].children[0].description="\u041f\u0440\u0438\u0442\u043e\u0447\u043d\u044b\u0439 \u0432\u0435\u043d\u0442\u0438\u043b\u044f\u0442\u043e\u0440 \u0441 \u0415\u0421-\u0434\u0432\u0438\u0433\u0430\u0442\u0435\u043b\u0435\u043c";
vent_nasos_ventil.children[0].children[0].description="\u041f\u0440\u0438\u0442\u043e\u0447\u043d\u044b\u0439 \u0432\u0435\u043d\u0442\u0438\u043b\u044f\u0442\u043e\u0440 \u0441 \u0415\u0421-\u0434\u0432\u0438\u0433\u0430\u0442\u0435\u043b\u0435\u043c";vent_nasos_korp2.children[0].children[0].description="\u0412\u044b\u0442\u044f\u0436\u043d\u043e\u0439 \u0432\u0435\u043d\u0442\u0438\u043b\u044f\u0442\u043e\u0440 \u0441 \u0415\u0421-\u0434\u0432\u0438\u0433\u0430\u0442\u0435\u043b\u0435\u043c";vent_nasos_ventil2.children[0].children[0].description=
"\u0412\u044b\u0442\u044f\u0436\u043d\u043e\u0439 \u0432\u0435\u043d\u0442\u0438\u043b\u044f\u0442\u043e\u0440 \u0441 \u0415\u0421-\u0434\u0432\u0438\u0433\u0430\u0442\u0435\u043b\u0435\u043c";ventilatorOutSide_korp.children[0].children[0].description="\u041e\u0441\u0435\u0432\u044b\u0435 \u0432\u0435\u043d\u0442\u0438\u043b\u044f\u0442\u043e\u0440\u044b \u043a\u043e\u043d\u0434\u0435\u043d\u0441\u0430\u0442\u043e\u0440\u0430";kompressoLOW.children[0].children[0].description="\u0412\u043e\u0437\u0434\u0443\u0448\u043d\u044b\u0439 \u043a\u043e\u043d\u0434\u0435\u043d\u0441\u0430\u0442\u043e\u0440 \u0438 \u043a\u043e\u043c\u043f\u0440\u0435\u0441\u0441\u043e\u0440\u043d\u044b\u0439 \u0431\u043b\u043e\u043a";
pauk.children[0].children[0].description="\u0424\u0440\u0435\u043e\u043d\u043e\u0432\u044b\u0439 \u0438\u0441\u043f\u0430\u0440\u0438\u0442\u0435\u043b\u044c \u0441 \u043a\u0430\u043f\u043b\u0435\u0443\u043b\u043e\u0432\u0438\u0442\u0435\u043b\u0435\u043c";nagretSoplya.children[0].children[0].description="\u0412\u043e\u0434\u044f\u043d\u043e\u0439 \u043d\u0430\u0433\u0440\u0435\u0432\u0430\u0442\u0435\u043b\u044c";diffuzorKorp.children[0].children[0].description="\u0420\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u0432\u043e\u0437\u0434\u0443\u0445\u043e\u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c";
zaslonka1_Rama.children[0].children[0].description="\u041a\u043b\u0430\u043f\u0430\u043d \u0432\u044b\u0431\u0440\u043e\u0441\u043d\u043e\u0433\u043e \u0432\u043e\u0437\u0434\u0443\u0445\u0430";zaslonka2_Rama.children[0].children[0].description="\u0412\u043e\u0437\u0434\u0443\u0445\u043e\u0437\u0430\u0431\u043e\u0440\u043d\u044b\u0439 \u043a\u043b\u0430\u043f\u0430\u043d";console.log("3d models loading complete!");blockLoad.style.display="none"};var sx_43=new THREE.Object3D;var sx_32_vert=new THREE.Object3D;
var sx_32=new THREE.Object3D;var sx_19_vert=new THREE.Object3D;var stoikiGroup=new THREE.Group;loadFBXModel(sx_43,1,matStoikaGoriz,"models/fbx/SX_43_LOW.fbx");loadFBXModel(sx_32,1,matStoikaGoriz2,"models/fbx/SX_32_low.fbx");loadFBXModel(sx_32_vert,1,matStoikaVert,"models/fbx/SX_32_vert_low.fbx");sx_43.position.set(1070,0,0);sx_32_vert.position.set(0,0,0);sx_32.position.set(-900,0,0);stoikiGroup.position.set(-200,-600,0);stoikiGroup.visible=false;stoikiGroup.add(sx_43);stoikiGroup.add(sx_32_vert);
stoikiGroup.add(sx_32);var btnbrony=document.getElementById("btnbrony");var blockLoad=document.getElementById("loading");var blockLoadProgress=document.getElementById("blockloading_progress");var btnPlay=document.getElementById("btnPlay");var btnfullscrn=document.getElementById("btnfullscrn");var rotateObj=document.getElementById("rotateObj");var cameraReset=document.getElementById("cameraReset");
function toggleFullScreen(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement)if(document.documentElement.requestFullscreen)document.documentElement.requestFullscreen();else if(document.documentElement.mozRequestFullScreen)document.documentElement.mozRequestFullScreen();else{if(document.documentElement.webkitRequestFullscreen)document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}else if(document.cancelFullScreen)document.cancelFullScreen();
else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen()}function setCursorGrab(){document.body.style.cursor="grab";document.body.style.cursor="-webkit-grab"}function setCursorGrabbing(){document.body.style.cursor="grabbing";document.body.style.cursor="-webkit-grabbing"}var easeInOutExpo=function(t,koef){var sigma0=1/(1+Math.exp(koef*.5));var sigma=1/(1+Math.exp(koef*(-t+.5)));return(sigma-sigma0)/(1-2*sigma0)};
var easeInExpo=function(t,koef){if(koef>5)return Math.exp(koef*(t-1));var sigma0=Math.exp(-koef);return(Math.exp(koef*(t-1))-sigma0)/(1-sigma0)};var easeInCirc=function(t){if(t>=1)return t;return-1*(Math.sqrt(1-t*t)-1)};var easeOutCubic=function(t){return--t*t*t+1};var easeOutCirc=function(t){return 1*Math.sqrt(1-(t=t-1)*t)};var easeOutQuint=function(t){return 1+--t*t*t*t*t};
var easeOutElastic=function(t){var s=1.70158;var p=0;var a=1;if(t==0)return 0;if(t==1)return 1;if(p==0)p=1*.3;if(a<1){a=.5;var s$0=p/4}else s=p/(2*Math.PI)*Math.asin(1/a);return a*Math.pow(2,-10*t)*Math.sin((t*1-s)*(2*Math.PI)/p)+1};var easeOutBounce=function(t){if(t<1/2.75)return 1*(7.5625*t*t);else if(t<2/2.75)return 1*(7.5625*(t=t-1.5/2.75)*t+.75);else if(t<2.5/2.75)return 1*(7.5625*(t=t-2.25/2.75)*t+.9375);else return 1*(7.5625*(t=t-2.625/2.75)*t+.984375)};
var easeInQuint=function(t){return t*t*t*t*t};var easeInOutCirc=function(t){if((t=t/.5)<1)return-1/2*(Math.sqrt(1-t*t)-1);return 1/2*(Math.sqrt(1-(t=t-2)*t)+1)};
var globalCameraPos=function(cameraPosSetup){var vectorCam=new THREE.Vector3(0,0,1);var axisY=new THREE.Vector3(0,1,0);var axisX=new THREE.Vector3(1,0,0);vectorCam.applyAxisAngle(axisX,THREE.Math.degToRad(cameraPosSetup.angelPlaneXZ)).normalize();vectorCam.applyAxisAngle(axisY,THREE.Math.degToRad(cameraPosSetup.angelOy)).normalize();camera.position.addVectors(cameraPosSetup.camLookAt,vectorCam.multiplyScalar(cameraPosSetup.distance));controls.target.x=cameraPosSetup.camLookAt.x;controls.target.y=
cameraPosSetup.camLookAt.y;controls.target.z=cameraPosSetup.camLookAt.z;controls.autoRotateSpeed=cameraPosSetup.autoRotSpeed};var CameraKeyTrckDefPos={playOn:false,loop:false,timeScale:1,times:[0,60],pause:[0,0],camLookAtx:[0,-25],camLookAty:[0,-80],camLookAtz:[0,0],distance:[0,4500],angelPlaneXZ:[0,-20],angelOy:[0,320],autoRotSpeed:[-3]};
var CameraKeyTrckFrontPos={playOn:false,loop:false,timeScale:1,times:[0,40],pause:[0,0],camLookAtx:[0,0],camLookAty:[0,-100],camLookAtz:[0,0],distance:[0,4E3],angelPlaneXZ:[0,0],angelOy:[0,0],autoRotSpeed:[-3]};
var CameraKeyTrckAllPos={playOn:false,loop:false,timeScale:1,times:[0,50,100,150,200,250,300,350],pause:[240,240,240,240,240,240,240,240],camLookAtx:[0,0,0,0,0,0,0,-25],camLookAty:[0,-100,-100,-200,-100,+50,-100,-80],camLookAtz:[0,0,0,0,0,0,0,0],distance:[0,4E3,4500,4E3,4E3,4E3,4E3,4500],angelPlaneXZ:[0,0,0,40,-40,0,0,-20],angelOy:[0,0,-90,0,0,90,180,320],divID:"#textblock1",divColor:"#BF360C",divFontSize:"1.7vmax",divLeft:[45,6,45,45,58,15,50],divTop:[55,55,60,60,60,55,60],textIDResource:["#ust1_1LevellInfo1",
"#ust1_1LevellInfo2","#ust1_1LevellInfo3","#ust1_1LevellInfo4","#ust1_1LevellInfo5","#ust1_1LevellInfo6","#ust1_1LevellInfo7"],autoRotSpeed:[-3]};
var CameraKeyTrck1={playOn:false,loop:false,timeScale:1,times:[0,50,100,150,200,250,300,350,400,450,500,550,600],pause:[240,240,240,240,240,240,240,240,240,240,240,0,0,0],camLookAtx:[0,-1186,-1238,-444,-339,-128,241,847,869,777,-689,-711,0],camLookAty:[0,474,524,648,398,507,586,632,611,345,-745,-1122,-100],camLookAtz:[0,-141,95,72,113,182,138,15,81,138,54,241,0],distance:[0,1426,1433,807,807,1120,1433,908,1070,908,871,605,4E3],angelPlaneXZ:[0,0,0,0,0,0,-39,0,0,0,-36,45,0],angelOy:[0,-41,50,-22,-22,
0,10,-7,49,37,37,10,0],autoRotSpeed:[-3],divID:"#textblock1",divColor:"#6A1B9A",divFontSize:"2.5vmax",divLeft:[10,10,10,10,10,10,10,10,10,10,10,10,10,10],divTop:[30,30,30,30,30,30,30,30,30,30,30,30,30,30],textIDResource:["#ust1_component1","#ust1_component3","#ust1_component4","#ust1_component5","#ust1_component6","#ust1_component7","#ust1_component8","#ust1_component9","#ust1_component10","#ust1_component11","#ust1_component12"]};
function calcOYangel(vectorCamera){var axisX=new THREE.Vector3(-1,0,0);vectorCamera.y=0;if(vectorCamera.x>0&&vectorCamera.z>0)return THREE.Math.radToDeg(vectorCamera.angleTo(axisX))-90;if(vectorCamera.x>0&&vectorCamera.z<0)return 90+90-(THREE.Math.radToDeg(vectorCamera.angleTo(axisX))-90);if(vectorCamera.x<0&&vectorCamera.z<0)return 180-(THREE.Math.radToDeg(vectorCamera.angleTo(axisX))-90);if(vectorCamera.x<0&&vectorCamera.z>0)return 270+90+(THREE.Math.radToDeg(vectorCamera.angleTo(axisX))-90);return 0}
function animateCamera(){var currentKey=0;var localTime=0;var cameraPosSetup={camLookAt:new THREE.Vector3(0,0,0),distance:0,angelPlaneXZ:0,angelOy:0,autoRotSpeed:0};var deltaT=0;var sigma;var delayShowText=900;return function(keyTrack){if(!keyTrack.playOn){currentKey=0;localTime=0;if(keyTrack.divID)$(keyTrack.divID).hide().empty();plyRed.style.display="none";return}if(keyTrack.playOn){if(currentKey==0&&localTime==0){console.log("%cAnim begin...","color: green;");var vectorCam=new THREE.Vector3(0,
0,0);var axisY=new THREE.Vector3(0,1,0);var axisZ=new THREE.Vector3(-1,0,0);keyTrack.camLookAtx[0]=controls.target.x;keyTrack.camLookAty[0]=controls.target.y;keyTrack.camLookAtz[0]=controls.target.z;keyTrack.distance[0]=camera.position.distanceTo(controls.target);vectorCam.subVectors(camera.position,controls.target);keyTrack.angelPlaneXZ[0]=THREE.Math.radToDeg(vectorCam.angleTo(axisY))-90;keyTrack.angelOy[0]=calcOYangel(vectorCam);keyTrack.autoRotSpeed[0]=controls.autoRotateSpeed;if(keyTrack.textIDResource!=
null){$(keyTrack.divID).hide().empty();$(keyTrack.divID).css("top",function(index,value){var newTop=keyTrack.divTop[0]+"%";return newTop});$(keyTrack.divID).css("left",function(index,value){var newTop=keyTrack.divLeft[0]+"%";return newTop});$(keyTrack.divID).css("background-color",keyTrack.divColor);$(keyTrack.divID).css("font-size",keyTrack.divFontSize);$(keyTrack.divID).text($(keyTrack.textIDResource[currentKey]).text());$(keyTrack.divID).delay(delayShowText).fadeIn(600).delay(keyTrack.pause[currentKey]*
100/6-delayShowText-0).fadeOut(300)}deltaT=(keyTrack.times[currentKey+1]-keyTrack.times[currentKey])*keyTrack.timeScale}if(localTime<deltaT+1){if(deltaT>0)sigma=easeOutCubic(localTime/deltaT);else{console.log("\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0435 deltaT \u0432 animateCamera()");sigma=1}cameraPosSetup.camLookAt.x=keyTrack.camLookAtx[currentKey]+(keyTrack.camLookAtx[currentKey+1]-keyTrack.camLookAtx[currentKey])*sigma;cameraPosSetup.camLookAt.y=keyTrack.camLookAty[currentKey]+
(keyTrack.camLookAty[currentKey+1]-keyTrack.camLookAty[currentKey])*sigma;cameraPosSetup.camLookAt.z=keyTrack.camLookAtz[currentKey]+(keyTrack.camLookAtz[currentKey+1]-keyTrack.camLookAtz[currentKey])*sigma;cameraPosSetup.distance=keyTrack.distance[currentKey]+(keyTrack.distance[currentKey+1]-keyTrack.distance[currentKey])*sigma;cameraPosSetup.angelOy=keyTrack.angelOy[currentKey]+(keyTrack.angelOy[currentKey+1]-keyTrack.angelOy[currentKey])*sigma;cameraPosSetup.angelPlaneXZ=keyTrack.angelPlaneXZ[currentKey]+
(keyTrack.angelPlaneXZ[currentKey+1]-keyTrack.angelPlaneXZ[currentKey])*sigma;cameraPosSetup.autoRotSpeed=keyTrack.autoRotSpeed[0];globalCameraPos(cameraPosSetup)}localTime++;if(localTime>deltaT+keyTrack.pause[currentKey]){localTime=0;console.log(currentKey);$(keyTrack.divID).hide().empty();currentKey++;deltaT=(keyTrack.times[currentKey+1]-keyTrack.times[currentKey])*keyTrack.timeScale;if(keyTrack.textIDResource!=null){$(keyTrack.divID).css("top",function(index,value){var newTop=keyTrack.divTop[currentKey]+
"%";return newTop});$(keyTrack.divID).css("left",function(index,value){var newTop=keyTrack.divLeft[currentKey]+"%";return newTop});$(keyTrack.divID).hide().empty();$(keyTrack.divID).css("font-size",keyTrack.divFontSize);$(keyTrack.divID).html($(keyTrack.textIDResource[currentKey]).html());$(keyTrack.divID).delay(delayShowText).fadeIn(600).delay(keyTrack.pause[currentKey]*100/6-delayShowText-0).fadeOut(300)}if(currentKey>keyTrack.times.length-2){if(!keyTrack.loop)keyTrack.playOn=false;currentKey=0;
console.log("%c...anim complete","color: red;");localTime=0;if(keyTrack.divID)$(keyTrack.divID).hide().empty();plyRed.style.display="none"}}}}}
function showCameraParam(){var vectorCam=new THREE.Vector3(0,0,0);var axisY=new THREE.Vector3(0,1,0);var axisZ=new THREE.Vector3(-1,0,0);var angelOy=0;var camLookAtx=controls.target.x;var camLookAty=controls.target.y;var camLookAtz=controls.target.z;var distance=camera.position.distanceTo(controls.target);vectorCam.subVectors(camera.position,controls.target);var angelPlaneXZ=THREE.Math.radToDeg(vectorCam.angleTo(axisY))-90;angelOy=calcOYangel(vectorCam);console.log("CamX=%d CamY=%d CamZ=%d",camera.position.x,
camera.position.y,camera.position.z);console.log("TarX=%d TarY=%d TarZ=%d",controls.target.x,controls.target.y,controls.target.z);console.log("dist=%d",distance);console.log("angelPlaneXZ=%d",angelPlaneXZ);console.log("angelOy=%d",angelOy);console.log("----------------------------")}btnTemp.addEventListener("click",showCameraParam);var width=640;var height=640;var aspect=1;width=window.innerWidth-0;height=window.innerHeight-0;aspect=width/height;var scene=new THREE.Scene;scene.background=new THREE.Color(16777215);
scene.fog=new THREE.Fog(scene.background,5E3,9E3);var camera=new THREE.PerspectiveCamera(35,aspect,100,9E3);var controls=new THREE.OrbitControls(camera);var cameraPosSetupDef={camLookAt:new THREE.Vector3(0,0,0),distance:1E4,angelPlaneXZ:0,angelOy:0,autoRotSpeed:-3};globalCameraPos(cameraPosSetupDef);controls.maxPolarAngle=Math.PI*.75;controls.noZoom=false;controls.zoomSpeed=.8;controls.autoRotate=false;controls.noRotate=false;controls.rotateSpeed=.8;controls.noPan=false;controls.keyPanSpeed=5;
dirLight=new THREE.DirectionalLight(16777215,1);dirLight.position.set(2,1.5,1.4);dirLight.position.multiplyScalar(1E3);scene.add(dirLight);hemiLight=new THREE.HemisphereLight(16777215,16777215,.9);hemiLight.color.setHSL(.6,1,.6);hemiLight.groundColor.setHSL(.095,1,.75);hemiLight.position.set(0,10,0);scene.add(hemiLight);var light=new THREE.PointLight(16777215,1.4,2E4,1);light.position.set(1500,1600,1E3);var sphereSize=100;var pointLightHelper=new THREE.PointLightHelper(light,sphereSize);
var light2=new THREE.PointLight(16777215,.4,2E4,1);light2.position.set(-1500,1800,-1E3);scene.add(light2);var canvas=document.getElementById("canvas-exemple");var renderer=new THREE.WebGLRenderer({canvas:canvas,antialias:true});renderer.setSize(window.innerWidth,window.innerHeight);renderer.setSize(width,height);renderer.gammaInput=true;renderer.gammaOutput=true;renderer.sortObjects=true;renderer.render(scene,camera);
function holodUst1Mode_1(){potok1.visible=!potok1.visible;potok1.children[0].children.sort(compareName);rekuperatorKorp.children[0].children.sort(compareName);for(var i=0;i<potok1.children[0].children.length;i++){if(i<81)potok1.children[0].children[i].material=matPotokRed;if(i>80&&i<81+21)potok1.children[0].children[i].material=matPotokPink;if(i>101&&i<101+26)potok1.children[0].children[i].material=matPotokDarkBlue;if(i>126&&i<126+19)potok1.children[0].children[i].material=matPotokBlue;if(i>145&&
i<145+46)potok1.children[0].children[i].material=matPotokPink;if(i>190)potok1.children[0].children[i].material=matPotokRed}if(potok1.visible){selectedObjectMode=true;rama.children[0].visible=false;barashki.children[0].visible=false;krisha.children[0].visible=false;replaceMaterial3DObj(ustanovka,false,matGhost);ventilatorOutSide.rotSpeed=.1;ustVent1.rotSpeed=.1;ustVent2.rotSpeed=.1;rotateGroup3D(diffuzorLopasti.children[0].children,30,"oX");rotateGroup3D(zaslonka1.children[0].children,-90,"oZ");rotateGroup3D(zaslonka2.children[0].children,
-90,"oZ");rotateGroup3D(rekuperatorZaslon1.children[0].children,-90,"oX");rotateGroup3D(rekuperatorZaslon2.children[0].children,-90,"oX");rotateGroup3D(rekuperatorZaslon3.children[0].children,0,"oX")}else{selectedObjectMode=false;rama.children[0].visible=true;krisha.children[0].visible=true;replaceMaterial3DObj(ustanovka,false,matGhost);ventilatorOutSide.rotSpeed=0;ustVent1.rotSpeed=0;ustVent2.rotSpeed=0;rotateGroup3D(diffuzorLopasti.children[0].children,0,"oX");rotateGroup3D(zaslonka1.children[0].children,
0,"oZ");rotateGroup3D(zaslonka2.children[0].children,0,"oZ");rotateGroup3D(rekuperatorZaslon1.children[0].children,0,"oX");rotateGroup3D(rekuperatorZaslon2.children[0].children,0,"oX");rotateGroup3D(rekuperatorZaslon3.children[0].children,-90,"oX")}}
function holodUst1Mode_2(){potok2.visible=!potok2.visible;potok2.children[0].children.sort(compareName);rekuperatorKorp.children[0].children.sort(compareName);for(var i=0;i<potok2.children[0].children.length;i++)if(i<152)potok2.children[0].children[i].material=matPotokPink;else potok2.children[0].children[i].material=matPotokRed;if(potok2.visible){selectedObjectMode=true;replaceMaterial3DObj(ustanovka,true,matGhost);replaceMaterial3DObj(ustVent1,false,matGhost);replaceMaterial3DObj(nagretSoplya,false,
matGhost);replaceMaterial3DObj(filtrKorman1,false,matGhost);rama.children[0].visible=false;barashki.children[0].visible=false;krisha.children[0].visible=false;ventilatorOutSide.rotSpeed=0;ustVent1.rotSpeed=.1;ustVent2.rotSpeed=0;rotateGroup3D(diffuzorLopasti.children[0].children,30,"oX");rotateGroup3D(zaslonka1.children[0].children,0,"oZ");rotateGroup3D(zaslonka2.children[0].children,0,"oZ");rotateGroup3D(rekuperatorZaslon1.children[0].children,0,"oX");rotateGroup3D(rekuperatorZaslon2.children[0].children,
-90,"oX");rotateGroup3D(rekuperatorZaslon3.children[0].children,-90,"oX")}else{selectedObjectMode=false;replaceMaterial3DObj(ustanovka,false,matGhost);rama.children[0].visible=true;krisha.children[0].visible=true;ventilatorOutSide.rotSpeed=0;ustVent1.rotSpeed=0;ustVent2.rotSpeed=0;rotateGroup3D(diffuzorLopasti.children[0].children,0,"oX");rotateGroup3D(zaslonka1.children[0].children,0,"oZ");rotateGroup3D(zaslonka2.children[0].children,0,"oZ");rotateGroup3D(rekuperatorZaslon1.children[0].children,
-90,"oX");rotateGroup3D(rekuperatorZaslon2.children[0].children,0,"oX");rotateGroup3D(rekuperatorZaslon3.children[0].children,0,"oX")}}
function animHolodUst1(timeTick){vent_nasos_ventil.rotation.z+=ustVent1.rotSpeed;vent_nasos_ventil2.rotation.z+=ustVent2.rotSpeed;ventilatorOutSide_lopasti.children[0].children[0].rotation.x+=ventilatorOutSide.rotSpeed;ventilatorOutSide_lopasti.children[0].children[1].rotation.x+=ventilatorOutSide.rotSpeed*1.02;ventilatorOutSide_lopasti.children[0].children[2].rotation.x-=ventilatorOutSide.rotSpeed*.8;ventilatorOutSide_lopasti.children[0].children[3].rotation.x-=ventilatorOutSide.rotSpeed*1.03;if(potok1.visible)for(var i=
0;i<potok1.children[0].children.length;i++)potok1.children[0].children[i].scale.y=potok1.children[0].children[i].scale.z=1-.99*(Math.sin(i/5-timeTick)+1);if(potok2.visible)for(var i$1=0;i$1<potok2.children[0].children.length;i$1++)potok2.children[0].children[i$1].scale.y=potok2.children[0].children[i$1].scale.z=1-.99*(Math.sin(i$1/5-timeTick)+1)}
function rotateGroup3D(group3DObject,rotateAngel,rotateAxis){if(rotateAxis=="oX")for(var i=0;i<group3DObject.length;i++)group3DObject[i].rotation.x=THREE.Math.degToRad(rotateAngel);if(rotateAxis=="oY")for(var i$2=0;i$2<group3DObject.length;i$2++)group3DObject[i$2].rotation.y=THREE.Math.degToRad(rotateAngel);if(rotateAxis=="oZ")for(var i$3=0;i$3<group3DObject.length;i$3++)group3DObject[i$3].rotation.z=THREE.Math.degToRad(rotateAngel)}scene.add(stoikiGroup);scene.add(ustanovka);scene.add(potok1);scene.add(potok2);
function compareName(a,b){if(a.name<b.name)return-1;if(a.name>b.name)return 1;return 0}function setCamera(){startCameraAnim(CameraKeyTrckDefPos)}btnRotateCamera.style.opacity=1;function toggleRotate(){controls.autoRotate=!controls.autoRotate;if(controls.autoRotate)btnRotateCamera.style.opacity=1;else btnRotateCamera.style.removeProperty("opacity")}function onCameraRotate(){controls.autoRotate=true;btnRotateCamera.style.opacity=1}
function offCameraRotate(){controls.autoRotate=false;btnRotateCamera.style.removeProperty("opacity")}
function stopCameraAnim(){selectedObjectMode=false;replaceMaterial3DObj(ustanovka,false,matGhost);rama.children[0].visible=true;rama.children[0].children[0].visible=true;rama.children[0].children[1].visible=false;barashki.children[0].visible=false;krisha.children[0].visible=true;offCameraRotate();$("#textblock1").hide().empty();CameraKeyTrck.playOn=false;console.log("Anim stop");plyRed.style.display="none";potok1.visible=false;potok2.visible=false;$("#help1").hide();setCursorGrab()}
function startCameraAnim(keyFrTrack){if(!CameraKeyTrck.playOn){offCameraRotate();CameraKeyTrck=keyFrTrack;CameraKeyTrck.playOn=true;return true}}
function replaceMaterial3DObj(group3DObj,replaceReset,materailReplace){for(var i=0;i<group3DObj.children.length;i++){if(group3DObj.children[0].children.length==1)if(replaceReset)group3DObj.children[0].children[0].material=materailReplace;else group3DObj.children[0].children[0].material=group3DObj.children[0].children[0].materialDefult;if(group3DObj.children[i].children.length==1)for(var ii=0;ii<group3DObj.children[i].children[0].children.length;ii++)if(replaceReset)group3DObj.children[i].children[0].children[ii].material=
materailReplace;else group3DObj.children[i].children[0].children[ii].material=group3DObj.children[i].children[0].children[ii].materialDefult;else for(var ii$4=0;ii$4<group3DObj.children[i].children.length;ii$4++)for(var iii=0;iii<group3DObj.children[i].children[ii$4].children[0].children.length;iii++)if(replaceReset)group3DObj.children[i].children[ii$4].children[0].children[iii].material=materailReplace;else group3DObj.children[i].children[ii$4].children[0].children[iii].material=group3DObj.children[i].children[ii$4].children[0].children[iii].materialDefult}}
var selectedObjectMode=false;function selectObject(){selectedObjectMode=!selectedObjectMode;if(selectedObjectMode){rama.children[0].children[1].visible=false;barashki.children[0].visible=false;btnSelectObject.style.opacity=1;replaceMaterial3DObj(ustanovka,true,matGhost)}else{replaceMaterial3DObj(ustanovka,false,matGhost);btnSelectObject.style.removeProperty("opacity");setCursorGrab()}}
function showGeneralInfo(){if(startCameraAnim(CameraKeyTrckAllPos)){selectedObjectMode=false;replaceMaterial3DObj(ustanovka,false,matGhost);plyRed.style.display="block";if(!potok1.visible)rama.children[0].children[0].material=matUstRama}}
function showDetailInfo(){if(startCameraAnim(CameraKeyTrck1)){selectedObjectMode=false;replaceMaterial3DObj(ustanovka,false,matGhost);plyRed.style.display="block";barashki.children[0].visible=false;rama.children[0].children[0].material=matGhost;rama.children[0].children[1].visible=false;vent_nasos_ventil.rotSpeed=.1;vent_nasos_ventil2.rotSpeed=.1}}function showHowItWork(){potok2.visible=false;offCameraRotate();startCameraAnim(CameraKeyTrckFrontPos);setTimeout(holodUst1Mode_1,400)}
function showHowItWork2(){potok1.visible=false;offCameraRotate();startCameraAnim(CameraKeyTrckFrontPos);setTimeout(holodUst1Mode_2,400)}function showHideBronya(){rama.children[0].children[1].visible=!rama.children[0].children[1].visible;if(rama.children[0].children[1].visible)barashki.children[0].visible=true;else barashki.children[0].visible=false}
function selectModels(){stoikiGroup.visible=!stoikiGroup.visible;ustanovka.visible=!ustanovka.visible;if(ustanovka.visible){setCamera();$("#controlPanel").css("display","flex").hide().fadeIn(100);btnModelsSelect2.style.display="none";btnModelsSelect1.style.display="block";controls.maxPolarAngle=Math.PI*.75}if(stoikiGroup.visible){potok1.visible=false;potok2.visible=false;stopCameraAnim();setCamera();onCameraRotate();controlPanel.style.display="none";btnModelsSelect2.style.display="block";btnModelsSelect1.style.display=
"none";controls.maxPolarAngle=Math.PI*.5}}btnSelectObject.addEventListener("click",selectObject);btnShow2LevellInfo.addEventListener("click",showDetailInfo);btnShow1LevellInfo.addEventListener("click",showGeneralInfo);btnShowHideBronya.addEventListener("click",showHideBronya);btnRotateCamera.addEventListener("click",toggleRotate);btnShowHowItWork.addEventListener("click",showHowItWork);btnShowHowItWork2.addEventListener("click",showHowItWork2);btnResetCemera.addEventListener("click",setCamera);
btnStopAnim.addEventListener("click",stopCameraAnim);btnFullscrn.addEventListener("click",toggleFullScreen);document.addEventListener("keydown",function(e){if(e.keyCode==13)toggleFullScreen()},false);btnModelsSelect1.addEventListener("click",selectModels);btnModelsSelect2.addEventListener("click",selectModels);window.addEventListener("resize",onWindowResize,false);
function onWindowResize(event){width=window.innerWidth-0;height=window.innerHeight-0;aspect=width/height;renderer.setSize(width,height);camera.aspect=aspect;camera.updateProjectionMatrix();controls.rotateSpeed=width/1920}var mouseDownState=true;renderer.domElement.addEventListener("mousedown",function(){mouseDownState=false},false);renderer.domElement.addEventListener("mouseup",function(){mouseDownState=true},false);var selectedObject={object:new THREE.Object3D,material:new THREE.MeshPhongMaterial};
var raycaster=new THREE.Raycaster;
function onDocumentMouseMove(event){if(selectedObjectMode){var mouse=new THREE.Vector2;var intersects;event.preventDefault();mouse.x=event.clientX/window.innerWidth*2-1;mouse.y=-(event.clientY/window.innerHeight)*2+1;raycaster.setFromCamera(mouse,camera);intersects=raycaster.intersectObjects([ustanovka],true);if(intersects.length>0&&intersects[0].object.description){document.body.style.cursor="pointer";if(intersects[0].object.material==matGhost&&intersects[0].object.description){$("#descriptionblock").fadeIn(600);$("#descriptionblock").text(intersects[0].object.description);
selectedObject.object.material=matGhost;selectedObject.object=intersects[0].object;intersects[0].object.material=intersects[0].object.materialDefult}}else if(intersects){$("#descriptionblock").hide().empty();selectedObject.object.material=matGhost;setCursorGrab();intersects=null}}}renderer.domElement.addEventListener("mousemove",onDocumentMouseMove,false);
window.onload=function(){matHolodSetup();matStoikiSetup();startCameraAnim(CameraKeyTrckDefPos);onCameraRotate();$("#controlPanel").css("display","flex").hide().delay(4E3).fadeIn(600);$("#cameraControl").css("display","flex").hide().delay(4E3).fadeIn(600);$("#copyRight").css("display","flex").hide().delay(4E3).fadeIn(600);$("#help1").delay(2E3).fadeIn(600).delay(8E3).fadeOut(600);$("#btnModelsSelect1").delay(4E3).fadeIn(600)};var animateCamera1=animateCamera();var tick=0;var CameraKeyTrck={playOn:false};
var animate=function(){requestAnimationFrame(animate);tick+=.075;if(globalLoad>25){animateCamera1(CameraKeyTrck);animHolodUst1(tick);controls.update();renderer.render(scene,camera)}};animate();
